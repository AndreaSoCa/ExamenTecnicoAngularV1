<form [formGroup]="tareaForm" (ngSubmit)="onSubmit()">
    <!-- Datos de la Tarea -->
    <label for="nombre">Nombre de la Tarea</label>
    <input id="nombre" formControlName="nombre" type="text">
    <div *ngIf="tareaForm.get('nombre')?.invalid && tareaForm.get('nombre')?.touched">
        El nombre es obligatorio.
    </div>

    <label for="fechaLimite">Fecha Límite</label>
    <input id="fechaLimite" formControlName="fechaLimite" type="date">
    <div *ngIf="tareaForm.get('fechaLimite')?.invalid && tareaForm.get('fechaLimite')?.touched">
        La fecha límite es obligatoria.
    </div>

    <!-- Personas -->
    <div formArrayName="personas">
        <div *ngFor="let persona of personas.controls; let i=index" [formGroupName]="i">
            <h3>Persona {{ i + 1 }}</h3>
            <div> 
                <label for="nombrePersona">Nombre Completo</label>
                <input type="text" id="nombrePersona" formControlName="nombre" placeholder="Nombre Completo">
                <div *ngIf="persona.get('nombre')?.invalid && persona.get('nombre')?.touched">
                    <span *ngIf="persona.get('nombre')?.errors?.['required']">El nombre es requerido</span>
                    <span *ngIf="persona.get('nombre')?.errors?.['minlength']">El nombre debe tener al menos 5 caracteres</span>
                </div>
            </div>
            
            <div>
                <label for="edadPersona">Edad</label>
                <input type="number" id="edadPersona" formControlName="edad">
                <div *ngIf="persona.get('edad')?.invalid && persona.get('edad')?.touched">
                    <span *ngIf="persona.get('edad')?.errors?.['required']">La edad es requerida y debe ser mayor a 18 años</span>
                    <span *ngIf="persona.get('edad')?.errors?.['min']">La edad debe ser mayor a 18</span>
                </div>
            </div>

            <!-- Habilidades -->
            <div formArrayName="habilidades">
                <div *ngFor="let habilidad of getHabilidades(i).controls; let j = index" [formGroupName]="j">
                    <label for="habilidad">Habilidad {{ j + 1 }}</label>
                    <input id="habilidad" [formControlName]="j" type="text">
                    <button type="button" (click)="eliminarHabilidad(i, j)">Eliminar Habilidad</button>
                </div>
                <button type="button" (click)="agregarHabilidad(i)">Agregar Habilidad</button>
            </div>

            <div *ngIf="getHabilidades(i).length === 0">
                Cada persona debe tener al menos una habilidad.
            </div>

            <button type="button" (click)="eliminarPersona(i)">Eliminar Persona</button>
        </div>
    </div>

    <div *ngIf="tareaForm.get('personas')?.errors?.['nombresDuplicados']">
        Los nombres de las personas no pueden repetirse.
    </div>

    <button type="button" (click)="agregarPersona()">Agregar Persona</button>

    <button type="submit" [disabled]="tareaForm.invalid">Crear Tarea</button>
</form>